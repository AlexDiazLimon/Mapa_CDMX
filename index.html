<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mapa CDMX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    #map { height: 100vh; width: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    var map = L.map('map').setView([19.4326, -99.1332], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // URL pública del CSV de Google Sheets
    var sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQcqhoYp0bGjmZswLeXOBLIKt8C67nTRcxUnXk_sET6TsBgxHvg0Jmn5n5vApov6lNKuGFI1vRfeGF7/pub?output=csv";

    // Leer los datos de la hoja
    Papa.parse(sheetUrl, {
      download: true,
      header: true,
      complete: function(results) {
        results.data.forEach(function(row) {
          if (row.Lat && row.Lon) {
            var icon = L.AwesomeMarkers.icon({
              icon: getIcon(row.Tipo),
              markerColor: getColor(row.Tipo),
              prefix: 'fa'
            });
            var popup = "<b>" + row.Nombre + "</b><br>" +
                        (row.Tipo || "") + "<br>" +
                        (row.IG ? "<a href='" + row.IG + "' target='_blank'>Instagram</a>" : "");
            L.marker([+row.Lat, +row.Lon], {icon: icon}).bindPopup(popup).addTo(map);
          }
        });
      }
    });

    // Función para íconos y colores
    function getIcon(tipo) {
      switch(tipo) {
        case "Cafetería": return "coffee";
        case "Museo": return "university";
        case "Biblioteca": return "book";
        case "Cine": return "film";
        case "Restaurante": return "cutlery";
        case "Iglesia": return "fire";
        case "Escultura": return "camera";
        default: return "map-marker";
      }
    }

    function getColor(tipo) {
      switch(tipo) {
        case "Cafetería": return "brown";
        case "Museo": return "lightblue";
        case "Biblioteca": return "green";
        case "Cine": return "orange";
        case "Restaurante": return "purple";
        case "Iglesia": return "darkgreen";
        case "Escultura": return "cadetblue";
        default: return "blue";
      }
    }

    L.control.attribution({
      position: 'bottomright'
    }).addAttribution('<span style="font-size:12px;color:gray;font-style:italic;">con amor para mi conejito</span>');
  </script>

  <!-- Librería de íconos awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.awesome-markers/2.0.4/leaflet.awesome-markers.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.awesome-markers/2.0.4/leaflet.awesome-markers.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
</body>
</html>
